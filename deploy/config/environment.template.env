# =============================================================================
# DIGITAL OCEAN DEPLOYMENT ENVIRONMENT CONFIGURATION
# =============================================================================
# 
# This file contains all environment variables required for the complete
# image optimization system deployment on Digital Ocean App Platform.
#
# SECURITY WARNING: Never commit actual values to version control.
# Use Digital Ocean's secure environment variable storage.
# =============================================================================

# =============================================================================
# CORE APPLICATION SETTINGS
# =============================================================================

# Node.js Environment
NODE_ENV=production
LOG_LEVEL=info

# Application Server Configuration
HOST=0.0.0.0
PORT=8080

# Application Metadata
APP_NAME=portfolio-image-optimization
APP_VERSION=1.0.0
DEPLOYMENT_ENVIRONMENT=production

# =============================================================================
# DATABASE CONNECTIONS
# =============================================================================

# Redis Configuration (Managed by Digital Ocean)
# Format: redis://username:password@host:port/database
REDIS_URL=${redis-cache.DATABASE_URL}
REDIS_TTL=3600
REDIS_MAX_CONNECTIONS=10
REDIS_RETRY_ATTEMPTS=3
REDIS_RETRY_DELAY=1000

# =============================================================================
# IMAGE OPTIMIZATION SERVICE CONFIGURATION
# =============================================================================

# Image Service Settings
IMAGE_SERVICE_URL=${image-optimizer.PRIVATE_URL}
IMAGE_SERVICE_PORT=3001
IMAGE_OPTIMIZATION_ENABLED=true

# Image Processing Limits
MAX_IMAGE_SIZE=10485760          # 10MB in bytes
MAX_IMAGE_WIDTH=2048
MAX_IMAGE_HEIGHT=2048
MAX_CONCURRENT_OPTIMIZATIONS=4

# Supported Image Formats
SUPPORTED_INPUT_FORMATS=jpeg,jpg,png,gif,bmp,tiff,svg
SUPPORTED_OUTPUT_FORMATS=jpeg,png,webp,avif

# Image Quality Settings
JPEG_QUALITY=85
PNG_COMPRESSION_LEVEL=6
WEBP_QUALITY=85
AVIF_QUALITY=80

# Image Cache Configuration
IMAGE_CACHE_TTL=86400           # 24 hours
IMAGE_CACHE_MAX_SIZE=1073741824 # 1GB
IMAGE_CACHE_CLEANUP_INTERVAL=3600 # 1 hour

# =============================================================================
# WORKER SERVICE CONFIGURATION
# =============================================================================

# Image Processing Workers
WORKER_CONCURRENCY=2
WORKER_TIMEOUT=30000            # 30 seconds
WORKER_MAX_RETRIES=3
WORKER_RETRY_DELAY=5000         # 5 seconds

# Queue Configuration
QUEUE_NAME=image-processing
QUEUE_MAX_JOBS=1000
QUEUE_DEFAULT_JOB_OPTIONS={"removeOnComplete":10,"removeOnFail":50}

# =============================================================================
# CONTENT DELIVERY NETWORK (CDN)
# =============================================================================

# CDN Configuration
CDN_ENABLED=true
CDN_BASE_URL=https://your-app-name.ondigitalocean.app
CDN_CACHE_CONTROL=public, max-age=31536000, immutable

# Static Assets
STATIC_ASSETS_PATH=/assets
STATIC_CACHE_TTL=31536000       # 1 year

# =============================================================================
# MONITORING AND OBSERVABILITY
# =============================================================================

# Monitoring Service
MONITORING_ENABLED=true
MONITORING_SERVICE_URL=${monitoring.PRIVATE_URL}
MONITORING_PORT=9090

# Metrics Collection
METRICS_ENDPOINT=/metrics
METRICS_COLLECTION_INTERVAL=30000 # 30 seconds
PERFORMANCE_MONITORING_ENABLED=true

# Health Check Configuration
HEALTH_CHECK_PATH=/api/health
HEALTH_CHECK_TIMEOUT=5000       # 5 seconds
HEALTH_CHECK_INTERVAL=10000     # 10 seconds

# =============================================================================
# ALERTING AND NOTIFICATIONS
# =============================================================================

# Alert Configuration
ALERT_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/WEBHOOK/URL
ALERT_EMAIL=ops@yourcompany.com

# Performance Thresholds
CPU_ALERT_THRESHOLD=80
MEMORY_ALERT_THRESHOLD=80
RESPONSE_TIME_ALERT_THRESHOLD=2000 # 2 seconds
ERROR_RATE_ALERT_THRESHOLD=5    # 5%

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# API Security
API_RATE_LIMIT=100              # requests per minute
API_RATE_LIMIT_WINDOW=60000     # 1 minute

# CORS Configuration
CORS_ORIGINS=https://yourportfolio.com,https://www.yourportfolio.com
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_HEADERS=Content-Type,Authorization,X-Requested-With

# Security Headers
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000          # 1 year
CONTENT_SECURITY_POLICY=default-src 'self'; img-src 'self' data: https:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log Settings
LOG_FORMAT=json
LOG_TIMESTAMP=true
LOG_COLORIZE=false

# Log Levels by Service
WEB_LOG_LEVEL=info
IMAGE_SERVICE_LOG_LEVEL=info
WORKER_LOG_LEVEL=info
MONITORING_LOG_LEVEL=warn

# Log Retention
LOG_RETENTION_DAYS=30
LOG_MAX_FILES=10
LOG_MAX_SIZE=10485760           # 10MB

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Node.js Performance
NODE_MAX_OLD_SPACE_SIZE=512
NODE_MAX_SEMI_SPACE_SIZE=128
UV_THREADPOOL_SIZE=4

# Request Handling
MAX_REQUEST_SIZE=10485760       # 10MB
REQUEST_TIMEOUT=30000           # 30 seconds
KEEP_ALIVE_TIMEOUT=5000         # 5 seconds

# Connection Pooling
HTTP_KEEP_ALIVE=true
HTTP_MAX_SOCKETS=50
HTTP_MAX_FREE_SOCKETS=10

# =============================================================================
# BACKUP AND DISASTER RECOVERY
# =============================================================================

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *       # Daily at 2 AM UTC
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=gzip

# Disaster Recovery
DR_ENABLED=true
DR_REGION=sfo3                  # Backup region
DR_SYNC_INTERVAL=3600           # 1 hour

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Feature Toggles
FEATURE_IMAGE_OPTIMIZATION=true
FEATURE_WEBP_CONVERSION=true
FEATURE_AVIF_CONVERSION=true
FEATURE_LAZY_LOADING=true
FEATURE_PROGRESSIVE_IMAGES=true
FEATURE_RESPONSIVE_IMAGES=true

# Experimental Features
EXPERIMENTAL_AI_OPTIMIZATION=false
EXPERIMENTAL_BATCH_PROCESSING=false

# =============================================================================
# DIGITAL OCEAN SPECIFIC SETTINGS
# =============================================================================

# App Platform Configuration
DO_APP_NAME=portfolio-image-optimization
DO_REGION=nyc1
DO_SIZE_SLUG=basic-xxs

# Database Configuration (Managed Services)
DO_REDIS_ENGINE=REDIS
DO_REDIS_VERSION=7
DO_REDIS_SIZE=basic
DO_REDIS_NODES=1

# =============================================================================
# THIRD-PARTY INTEGRATIONS
# =============================================================================

# Analytics (if using external service)
ANALYTICS_ENABLED=false
ANALYTICS_API_KEY=your_analytics_api_key
ANALYTICS_SITE_ID=your_site_id

# Error Reporting (if using external service)
ERROR_REPORTING_ENABLED=false
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id

# =============================================================================
# DEVELOPMENT AND TESTING OVERRIDES
# =============================================================================
# These variables are only used in non-production environments

# Development Settings
DEV_IMAGE_CACHE_DISABLED=false
DEV_MOCK_EXTERNAL_SERVICES=false
DEV_ENABLE_DEBUG_ROUTES=false

# Testing Settings
TEST_DATABASE_URL=redis://localhost:6379/1
TEST_SKIP_SLOW_TESTS=false
TEST_PARALLEL_WORKERS=2

# =============================================================================
# SECRETS AND SENSITIVE DATA
# =============================================================================
# These must be configured as SECRET type in Digital Ocean App Platform

# Required Secrets (configure in DO dashboard):
# - REDIS_URL (if using external Redis)
# - GRAFANA_ADMIN_PASSWORD
# - ALERT_WEBHOOK_URL
# - PERFORMANCE_MONITORING_URL
# - REPORT_WEBHOOK_URL (for performance reports)
# - API_KEYS (if using external services)
# - DATABASE_ENCRYPTION_KEY (if storing sensitive data)

# =============================================================================
# VALIDATION RULES
# =============================================================================
# The following rules should be enforced in deployment scripts:

# Required Variables:
# - NODE_ENV must be 'production'
# - REDIS_URL must be valid Redis connection string
# - All *_URL variables must be valid URLs
# - All *_PORT variables must be valid port numbers (1-65535)
# - All *_SIZE variables must be positive integers
# - All *_TIMEOUT variables must be positive integers
# - All boolean flags must be 'true' or 'false'

# Security Requirements:
# - All SECRET type variables must be configured in DO dashboard
# - No hardcoded passwords or API keys in this file
# - CORS_ORIGINS must include only allowed domains
# - API_RATE_LIMIT must be reasonable (not disabled)

# Performance Requirements:
# - WORKER_CONCURRENCY should not exceed available CPU cores
# - MAX_IMAGE_SIZE should be reasonable for your use case
# - Cache TTL values should balance performance vs freshness
# - Log retention should balance debugging needs vs storage costs