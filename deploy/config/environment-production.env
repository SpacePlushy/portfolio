# =============================================================================
# PRODUCTION ENVIRONMENT CONFIGURATION
# =============================================================================
# 
# This file contains production-specific environment variables.
# These values should be configured as secrets in Digital Ocean App Platform.
#
# SECURITY WARNING: Never commit actual production values to version control.
# Use Digital Ocean's secure environment variable storage.
# =============================================================================

# =============================================================================
# CORE APPLICATION SETTINGS
# =============================================================================

NODE_ENV=production
LOG_LEVEL=info
HOST=0.0.0.0
PORT=8080

# Application metadata
APP_NAME=portfolio-image-optimization
APP_VERSION=1.0.0
DEPLOYMENT_ENVIRONMENT=production

# =============================================================================
# DATABASE CONNECTIONS
# =============================================================================

# Redis Configuration (Managed by Digital Ocean)
REDIS_URL=${redis-cache.DATABASE_URL}
REDIS_TTL=3600
REDIS_MAX_CONNECTIONS=20
REDIS_RETRY_ATTEMPTS=3
REDIS_RETRY_DELAY=1000

# =============================================================================
# IMAGE OPTIMIZATION SERVICE CONFIGURATION
# =============================================================================

# Image Service Settings
IMAGE_SERVICE_URL=${image-optimizer.PRIVATE_URL}
IMAGE_SERVICE_PORT=3001
IMAGE_OPTIMIZATION_ENABLED=true

# Image Processing Limits
MAX_IMAGE_SIZE=10485760          # 10MB
MAX_IMAGE_WIDTH=4096
MAX_IMAGE_HEIGHT=4096
MAX_CONCURRENT_OPTIMIZATIONS=8

# Supported Image Formats
SUPPORTED_INPUT_FORMATS=jpeg,jpg,png,gif,bmp,tiff,svg
SUPPORTED_OUTPUT_FORMATS=jpeg,png,webp,avif

# Image Quality Settings
JPEG_QUALITY=85
PNG_COMPRESSION_LEVEL=6
WEBP_QUALITY=85
AVIF_QUALITY=80

# Image Cache Configuration
IMAGE_CACHE_TTL=86400           # 24 hours
IMAGE_CACHE_MAX_SIZE=2147483648 # 2GB
IMAGE_CACHE_CLEANUP_INTERVAL=3600 # 1 hour

# =============================================================================
# WORKER SERVICE CONFIGURATION
# =============================================================================

# Image Processing Workers
WORKER_CONCURRENCY=4
WORKER_TIMEOUT=30000            # 30 seconds
WORKER_MAX_RETRIES=3
WORKER_RETRY_DELAY=5000         # 5 seconds

# Queue Configuration
QUEUE_NAME=image-processing
QUEUE_MAX_JOBS=2000
QUEUE_DEFAULT_JOB_OPTIONS={"removeOnComplete":20,"removeOnFail":100,"attempts":3}

# =============================================================================
# CONTENT DELIVERY NETWORK (CDN)
# =============================================================================

# CDN Configuration
CDN_ENABLED=true
CDN_BASE_URL=https://frankpalmisano.com
CDN_CACHE_CONTROL=public, max-age=31536000, immutable

# Static Assets
STATIC_ASSETS_PATH=/assets
STATIC_CACHE_TTL=31536000       # 1 year

# =============================================================================
# MONITORING AND OBSERVABILITY
# =============================================================================

# Monitoring Service
MONITORING_ENABLED=true
MONITORING_SERVICE_URL=${monitoring.PRIVATE_URL}
MONITORING_PORT=9090

# Metrics Collection
METRICS_ENDPOINT=/metrics
METRICS_COLLECTION_INTERVAL=15000 # 15 seconds
PERFORMANCE_MONITORING_ENABLED=true

# Health Check Configuration
HEALTH_CHECK_PATH=/api/health
HEALTH_CHECK_TIMEOUT=5000       # 5 seconds
HEALTH_CHECK_INTERVAL=10000     # 10 seconds

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# API Security
API_RATE_LIMIT=200              # requests per minute
API_RATE_LIMIT_WINDOW=60000     # 1 minute
IMAGE_UPLOAD_RATE_LIMIT=30      # uploads per minute

# CORS Configuration
CORS_ORIGINS=https://frankpalmisano.com,https://www.frankpalmisano.com
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_HEADERS=Content-Type,Authorization,X-Requested-With,Accept,Origin,Cache-Control

# Security Headers
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000          # 1 year
CONTENT_SECURITY_POLICY=default-src 'self'; img-src 'self' data: https: blob:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; font-src 'self' data:; connect-src 'self'; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self'

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log Settings
LOG_FORMAT=json
LOG_TIMESTAMP=true
LOG_COLORIZE=false

# Log Levels by Service
WEB_LOG_LEVEL=info
IMAGE_SERVICE_LOG_LEVEL=info
WORKER_LOG_LEVEL=info
MONITORING_LOG_LEVEL=warn

# Log Retention
LOG_RETENTION_DAYS=90
LOG_MAX_FILES=20
LOG_MAX_SIZE=52428800           # 50MB

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Node.js Performance
NODE_MAX_OLD_SPACE_SIZE=1024
NODE_MAX_SEMI_SPACE_SIZE=256
UV_THREADPOOL_SIZE=8

# Request Handling
MAX_REQUEST_SIZE=15728640       # 15MB
REQUEST_TIMEOUT=30000           # 30 seconds
KEEP_ALIVE_TIMEOUT=5000         # 5 seconds

# Connection Pooling
HTTP_KEEP_ALIVE=true
HTTP_MAX_SOCKETS=100
HTTP_MAX_FREE_SOCKETS=20

# Sharp.js Performance
SHARP_CACHE_SIZE=500
SHARP_CONCURRENCY=8
SHARP_SIMD=true

# =============================================================================
# BACKUP AND DISASTER RECOVERY
# =============================================================================

# Backup Configuration
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *       # Daily at 2 AM UTC
BACKUP_RETENTION_DAYS=30
BACKUP_COMPRESSION=gzip

# Disaster Recovery
DR_ENABLED=true
DR_REGION=sfo3                  # Backup region
DR_SYNC_INTERVAL=3600           # 1 hour

# =============================================================================
# FEATURE FLAGS
# =============================================================================

# Core Features
FEATURE_IMAGE_OPTIMIZATION=true
FEATURE_WEBP_CONVERSION=true
FEATURE_AVIF_CONVERSION=true
FEATURE_LAZY_LOADING=true
FEATURE_PROGRESSIVE_IMAGES=true
FEATURE_RESPONSIVE_IMAGES=true

# Advanced Features
FEATURE_AUTO_QUALITY_ADJUSTMENT=true
FEATURE_SMART_CROPPING=false
FEATURE_BACKGROUND_REMOVAL=false
FEATURE_AI_UPSCALING=false

# Experimental Features
EXPERIMENTAL_NEXT_GEN_FORMATS=false
EXPERIMENTAL_BATCH_PROCESSING=false
EXPERIMENTAL_EDGE_OPTIMIZATION=false

# =============================================================================
# DIGITAL OCEAN SPECIFIC SETTINGS
# =============================================================================

# App Platform Configuration
DO_APP_NAME=portfolio-image-optimization
DO_REGION=nyc1
DO_SIZE_SLUG=basic-xs

# Database Configuration (Managed Services)
DO_REDIS_ENGINE=REDIS
DO_REDIS_VERSION=7
DO_REDIS_SIZE=basic
DO_REDIS_NODES=1

# =============================================================================
# ALERTING AND NOTIFICATIONS
# =============================================================================

# Performance Thresholds
CPU_ALERT_THRESHOLD=80
MEMORY_ALERT_THRESHOLD=80
DISK_ALERT_THRESHOLD=85
RESPONSE_TIME_ALERT_THRESHOLD=2000 # 2 seconds
ERROR_RATE_ALERT_THRESHOLD=5    # 5%
QUEUE_SIZE_ALERT_THRESHOLD=100

# Alert Escalation
ALERT_ESCALATION_ENABLED=true
ALERT_ESCALATION_DELAY=300      # 5 minutes
ALERT_ESCALATION_MULTIPLIER=2

# =============================================================================
# AUTOSCALING CONFIGURATION
# =============================================================================

# Horizontal Scaling
AUTOSCALING_ENABLED=true
MIN_INSTANCES=2
MAX_INSTANCES=10
TARGET_CPU_UTILIZATION=70
TARGET_MEMORY_UTILIZATION=80

# Scaling Policies
SCALE_UP_COOLDOWN=120           # 2 minutes
SCALE_DOWN_COOLDOWN=300         # 5 minutes
SCALE_UP_INCREMENT=2
SCALE_DOWN_DECREMENT=1

# Custom Metrics Scaling
QUEUE_SIZE_SCALE_UP_THRESHOLD=50
RESPONSE_TIME_SCALE_UP_THRESHOLD=2000
ERROR_RATE_SCALE_UP_THRESHOLD=5

# =============================================================================
# THIRD-PARTY INTEGRATIONS
# =============================================================================

# Analytics (optional)
ANALYTICS_ENABLED=false
ANALYTICS_PROVIDER=none

# Error Reporting (optional)
ERROR_REPORTING_ENABLED=false
ERROR_REPORTING_PROVIDER=none

# CDN Provider (Digital Ocean Spaces CDN)
CDN_PROVIDER=digitalocean
CDN_DISTRIBUTION_ID=auto

# =============================================================================
# SECRETS AND SENSITIVE DATA
# =============================================================================
# These must be configured as SECRET type in Digital Ocean App Platform

# Required Secrets (configure in DO dashboard):
# - REDIS_URL (if using external Redis)
# - GRAFANA_ADMIN_PASSWORD
# - ALERT_WEBHOOK_URL
# - PERFORMANCE_MONITORING_URL
# - REPORT_WEBHOOK_URL
# - BACKUP_ENCRYPTION_KEY
# - DO_SPACES_ACCESS_KEY
# - DO_SPACES_SECRET_KEY
# - SLACK_WEBHOOK_URL (if using Slack notifications)
# - EMAIL_SERVICE_API_KEY (if using email notifications)

# =============================================================================
# DEPLOYMENT METADATA
# =============================================================================

# Build Information (set by CI/CD)
BUILD_NUMBER=${GITHUB_RUN_NUMBER}
GIT_COMMIT=${GITHUB_SHA}
BUILD_TIME=${BUILD_TIMESTAMP}
DEPLOYMENT_ID=${GITHUB_RUN_ID}

# Environment Information
DEPLOYMENT_REGION=nyc1
DEPLOYMENT_ZONE=us-east-1
DEPLOYMENT_TIER=production

# =============================================================================
# VALIDATION AND HEALTH CHECKS
# =============================================================================

# Validation Rules
VALIDATE_IMAGE_HEADERS=true
VALIDATE_FILE_EXTENSIONS=true
VALIDATE_MIME_TYPES=true
VALIDATE_FILE_SIZE=true

# Health Check Endpoints
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_DEPENDENCIES=true
READINESS_CHECK_ENABLED=true
LIVENESS_CHECK_ENABLED=true

# Dependency Health Checks
CHECK_REDIS_HEALTH=true
CHECK_STORAGE_HEALTH=true
CHECK_WORKER_HEALTH=true

# =============================================================================
# RESOURCE LIMITS AND QUOTAS
# =============================================================================

# Memory Limits
HEAP_SIZE_LIMIT=1073741824      # 1GB
WORKER_MEMORY_LIMIT=536870912   # 512MB
CACHE_MEMORY_LIMIT=268435456    # 256MB

# Processing Limits
MAX_CONCURRENT_UPLOADS=10
MAX_PROCESSING_QUEUE_SIZE=200
MAX_CACHE_ENTRIES=10000

# Rate Limiting Quotas
HOURLY_UPLOAD_LIMIT=1000
DAILY_UPLOAD_LIMIT=10000
MONTHLY_PROCESSING_LIMIT=100000

# =============================================================================
# COMPLIANCE AND GOVERNANCE
# =============================================================================

# Data Retention
DATA_RETENTION_ENABLED=true
PROCESSED_IMAGE_RETENTION_DAYS=365
LOG_RETENTION_DAYS=90
METRICS_RETENTION_DAYS=30

# Privacy and Security
GDPR_COMPLIANCE_ENABLED=false  # Portfolio doesn't collect personal data
PII_DETECTION_ENABLED=false
DATA_ANONYMIZATION_ENABLED=false

# Audit Logging
AUDIT_LOGGING_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=365
SECURITY_EVENT_LOGGING=true