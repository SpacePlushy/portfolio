# =============================================================================
# STAGING ENVIRONMENT CONFIGURATION
# =============================================================================
# 
# This file contains staging-specific environment variables.
# Staging mimics production but with reduced resources and relaxed security.
#
# =============================================================================

# =============================================================================
# CORE APPLICATION SETTINGS
# =============================================================================

NODE_ENV=staging
LOG_LEVEL=debug
HOST=0.0.0.0
PORT=8080

# Application metadata
APP_NAME=portfolio-image-optimization-staging
APP_VERSION=1.0.0-staging
DEPLOYMENT_ENVIRONMENT=staging

# =============================================================================
# DATABASE CONNECTIONS
# =============================================================================

# Redis Configuration (Managed by Digital Ocean)
REDIS_URL=${redis-cache.DATABASE_URL}
REDIS_TTL=1800                  # 30 minutes (shorter for staging)
REDIS_MAX_CONNECTIONS=10        # Reduced for staging
REDIS_RETRY_ATTEMPTS=3
REDIS_RETRY_DELAY=1000

# =============================================================================
# IMAGE OPTIMIZATION SERVICE CONFIGURATION
# =============================================================================

# Image Service Settings
IMAGE_SERVICE_URL=${image-optimizer.PRIVATE_URL}
IMAGE_SERVICE_PORT=3001
IMAGE_OPTIMIZATION_ENABLED=true

# Image Processing Limits (reduced for staging)
MAX_IMAGE_SIZE=5242880          # 5MB (smaller than prod)
MAX_IMAGE_WIDTH=2048            # Reduced dimensions
MAX_IMAGE_HEIGHT=2048
MAX_CONCURRENT_OPTIMIZATIONS=4  # Reduced concurrency

# Supported Image Formats
SUPPORTED_INPUT_FORMATS=jpeg,jpg,png,gif,webp
SUPPORTED_OUTPUT_FORMATS=jpeg,png,webp

# Image Quality Settings (lower quality for faster processing)
JPEG_QUALITY=80
PNG_COMPRESSION_LEVEL=4
WEBP_QUALITY=80
AVIF_QUALITY=75

# Image Cache Configuration
IMAGE_CACHE_TTL=1800            # 30 minutes
IMAGE_CACHE_MAX_SIZE=536870912  # 512MB
IMAGE_CACHE_CLEANUP_INTERVAL=1800 # 30 minutes

# =============================================================================
# WORKER SERVICE CONFIGURATION
# =============================================================================

# Image Processing Workers (reduced for staging)
WORKER_CONCURRENCY=2
WORKER_TIMEOUT=60000            # 60 seconds (longer for debugging)
WORKER_MAX_RETRIES=2
WORKER_RETRY_DELAY=3000         # 3 seconds

# Queue Configuration
QUEUE_NAME=image-processing-staging
QUEUE_MAX_JOBS=100              # Reduced queue size
QUEUE_DEFAULT_JOB_OPTIONS={"removeOnComplete":5,"removeOnFail":20,"attempts":2}

# =============================================================================
# CONTENT DELIVERY NETWORK (CDN)
# =============================================================================

# CDN Configuration (disabled in staging)
CDN_ENABLED=false
CDN_BASE_URL=https://portfolio-staging.ondigitalocean.app
CDN_CACHE_CONTROL=public, max-age=300 # 5 minutes cache

# Static Assets
STATIC_ASSETS_PATH=/assets
STATIC_CACHE_TTL=300            # 5 minutes

# =============================================================================
# MONITORING AND OBSERVABILITY
# =============================================================================

# Monitoring Service
MONITORING_ENABLED=true
MONITORING_SERVICE_URL=${monitoring.PRIVATE_URL}
MONITORING_PORT=9090

# Metrics Collection (more frequent for testing)
METRICS_ENDPOINT=/metrics
METRICS_COLLECTION_INTERVAL=10000 # 10 seconds
PERFORMANCE_MONITORING_ENABLED=true

# Health Check Configuration
HEALTH_CHECK_PATH=/api/health
HEALTH_CHECK_TIMEOUT=10000      # 10 seconds (longer for debugging)
HEALTH_CHECK_INTERVAL=15000     # 15 seconds

# =============================================================================
# DEBUGGING AND DEVELOPMENT
# =============================================================================

# Debug Settings
DEBUG_MODE=true
VERBOSE_LOGGING=true
DEBUG_SHARP=true
WORKER_DEBUG=true
PROCESS_MONITORING=true

# Development Features
DEV_IMAGE_CACHE_DISABLED=false
DEV_MOCK_EXTERNAL_SERVICES=false
DEV_ENABLE_DEBUG_ROUTES=true

# =============================================================================
# SECURITY CONFIGURATION (RELAXED FOR STAGING)
# =============================================================================

# API Security (more permissive)
API_RATE_LIMIT=500              # Higher limit for testing
API_RATE_LIMIT_WINDOW=60000
IMAGE_UPLOAD_RATE_LIMIT=100     # Higher upload limit

# CORS Configuration (includes localhost)
CORS_ORIGINS=https://portfolio-staging.ondigitalocean.app,http://localhost:4321,http://localhost:3000
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS,HEAD
CORS_HEADERS=Content-Type,Authorization,X-Requested-With,Accept,Origin,Cache-Control,X-Debug-Token

# Security Headers (relaxed CSP for testing)
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=86400             # 1 day
CONTENT_SECURITY_POLICY=default-src 'self' 'unsafe-inline' 'unsafe-eval'; img-src 'self' data: https: blob:; connect-src 'self' ws: wss:

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log Settings (verbose for staging)
LOG_FORMAT=json
LOG_TIMESTAMP=true
LOG_COLORIZE=true

# Log Levels by Service (debug level)
WEB_LOG_LEVEL=debug
IMAGE_SERVICE_LOG_LEVEL=debug
WORKER_LOG_LEVEL=debug
MONITORING_LOG_LEVEL=info

# Log Retention (shorter for staging)
LOG_RETENTION_DAYS=14
LOG_MAX_FILES=10
LOG_MAX_SIZE=10485760           # 10MB

# =============================================================================
# PERFORMANCE TUNING (REDUCED FOR STAGING)
# =============================================================================

# Node.js Performance
NODE_MAX_OLD_SPACE_SIZE=512     # Reduced memory
NODE_MAX_SEMI_SPACE_SIZE=128
UV_THREADPOOL_SIZE=4

# Request Handling
MAX_REQUEST_SIZE=10485760       # 10MB
REQUEST_TIMEOUT=60000           # 60 seconds (longer for debugging)
KEEP_ALIVE_TIMEOUT=10000        # 10 seconds

# Connection Pooling
HTTP_KEEP_ALIVE=true
HTTP_MAX_SOCKETS=50
HTTP_MAX_FREE_SOCKETS=10

# Sharp.js Performance
SHARP_CACHE_SIZE=100
SHARP_CONCURRENCY=2
SHARP_SIMD=true

# =============================================================================
# BACKUP AND DISASTER RECOVERY (SIMPLIFIED FOR STAGING)
# =============================================================================

# Backup Configuration (reduced frequency)
BACKUP_ENABLED=false           # Disabled in staging
BACKUP_SCHEDULE=0 6 * * 0      # Weekly
BACKUP_RETENTION_DAYS=7
BACKUP_COMPRESSION=gzip

# Disaster Recovery (disabled)
DR_ENABLED=false

# =============================================================================
# FEATURE FLAGS (EXPERIMENTAL FEATURES ENABLED)
# =============================================================================

# Core Features
FEATURE_IMAGE_OPTIMIZATION=true
FEATURE_WEBP_CONVERSION=true
FEATURE_AVIF_CONVERSION=false  # Disabled for faster testing
FEATURE_LAZY_LOADING=true
FEATURE_PROGRESSIVE_IMAGES=true
FEATURE_RESPONSIVE_IMAGES=true

# Advanced Features (testing enabled)
FEATURE_AUTO_QUALITY_ADJUSTMENT=true
FEATURE_SMART_CROPPING=false
FEATURE_BACKGROUND_REMOVAL=false
FEATURE_AI_UPSCALING=false

# Experimental Features (enabled for testing)
EXPERIMENTAL_NEXT_GEN_FORMATS=true
EXPERIMENTAL_BATCH_PROCESSING=true
EXPERIMENTAL_EDGE_OPTIMIZATION=false

# =============================================================================
# DIGITAL OCEAN SPECIFIC SETTINGS
# =============================================================================

# App Platform Configuration
DO_APP_NAME=portfolio-image-optimization-staging
DO_REGION=nyc1
DO_SIZE_SLUG=basic-xxs

# Database Configuration (smaller instances)
DO_REDIS_ENGINE=REDIS
DO_REDIS_VERSION=7
DO_REDIS_SIZE=basic
DO_REDIS_NODES=1

# =============================================================================
# ALERTING AND NOTIFICATIONS (RELAXED THRESHOLDS)
# =============================================================================

# Performance Thresholds (higher for staging)
CPU_ALERT_THRESHOLD=95
MEMORY_ALERT_THRESHOLD=95
DISK_ALERT_THRESHOLD=95
RESPONSE_TIME_ALERT_THRESHOLD=5000 # 5 seconds
ERROR_RATE_ALERT_THRESHOLD=20   # 20%
QUEUE_SIZE_ALERT_THRESHOLD=50

# Alert Escalation (disabled)
ALERT_ESCALATION_ENABLED=false

# =============================================================================
# AUTOSCALING CONFIGURATION (DISABLED FOR STAGING)
# =============================================================================

# Horizontal Scaling (disabled)
AUTOSCALING_ENABLED=false
MIN_INSTANCES=1
MAX_INSTANCES=2
TARGET_CPU_UTILIZATION=95
TARGET_MEMORY_UTILIZATION=95

# =============================================================================
# TESTING CONFIGURATION
# =============================================================================

# Test Settings
TEST_MODE=true
INTEGRATION_TESTS_ENABLED=true
PERFORMANCE_TESTS_ENABLED=true
LOAD_TESTING_ENABLED=true

# Test Overrides
TEST_DATABASE_URL=redis://localhost:6379/1
TEST_SKIP_SLOW_TESTS=false
TEST_PARALLEL_WORKERS=2
TEST_TIMEOUT=30000

# Mock Services
MOCK_EXTERNAL_APIS=false
MOCK_PAYMENT_PROCESSING=true
MOCK_EMAIL_SERVICE=true

# =============================================================================
# CI/CD CONFIGURATION
# =============================================================================

# Build Settings
BUILD_FOR_TESTING=true
INCLUDE_DEV_DEPENDENCIES=true
SKIP_OPTIMIZATION=false
ENABLE_SOURCE_MAPS=true

# Deployment Settings
DEPLOYMENT_STRATEGY=blue_green
HEALTH_CHECK_TIMEOUT=60
ROLLBACK_ON_FAILURE=true
NOTIFICATION_ON_DEPLOY=true

# =============================================================================
# SECRETS AND SENSITIVE DATA (STAGING VERSIONS)
# =============================================================================
# These should be configured as SECRET type in Digital Ocean App Platform

# Required Secrets (staging versions):
# - REDIS_URL
# - GRAFANA_ADMIN_PASSWORD_STAGING
# - ALERT_WEBHOOK_URL_STAGING
# - SLACK_WEBHOOK_URL_STAGING
# - EMAIL_SERVICE_API_KEY_STAGING

# =============================================================================
# DEPLOYMENT METADATA
# =============================================================================

# Build Information
BUILD_NUMBER=${GITHUB_RUN_NUMBER}
GIT_COMMIT=${GITHUB_SHA}
BUILD_TIME=${BUILD_TIMESTAMP}
DEPLOYMENT_ID=${GITHUB_RUN_ID}
BRANCH_NAME=${GITHUB_REF_NAME}

# Environment Information
DEPLOYMENT_REGION=nyc1
DEPLOYMENT_ZONE=us-east-1
DEPLOYMENT_TIER=staging

# =============================================================================
# VALIDATION AND HEALTH CHECKS (RELAXED)
# =============================================================================

# Validation Rules
VALIDATE_IMAGE_HEADERS=true
VALIDATE_FILE_EXTENSIONS=false # Relaxed for testing
VALIDATE_MIME_TYPES=true
VALIDATE_FILE_SIZE=true

# Health Check Endpoints
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_DEPENDENCIES=true
READINESS_CHECK_ENABLED=true
LIVENESS_CHECK_ENABLED=true

# =============================================================================
# RESOURCE LIMITS AND QUOTAS (REDUCED)
# =============================================================================

# Memory Limits (reduced)
HEAP_SIZE_LIMIT=536870912       # 512MB
WORKER_MEMORY_LIMIT=268435456   # 256MB
CACHE_MEMORY_LIMIT=134217728    # 128MB

# Processing Limits
MAX_CONCURRENT_UPLOADS=5
MAX_PROCESSING_QUEUE_SIZE=50
MAX_CACHE_ENTRIES=1000

# Rate Limiting Quotas (higher for testing)
HOURLY_UPLOAD_LIMIT=2000
DAILY_UPLOAD_LIMIT=20000
MONTHLY_PROCESSING_LIMIT=500000

# =============================================================================
# DEVELOPMENT TOOLS AND DEBUGGING
# =============================================================================

# Debugging Tools
ENABLE_DEBUGGER=true
PROFILING_ENABLED=true
MEMORY_PROFILING=true
CPU_PROFILING=false

# Development Endpoints
ENABLE_DEBUG_ENDPOINTS=true
ENABLE_ADMIN_PANEL=false
ENABLE_METRICS_UI=true

# Hot Reloading (if applicable)
HOT_RELOAD_ENABLED=false
WATCH_FILES=false

# =============================================================================
# BROWSER TESTING CONFIGURATION
# =============================================================================

# Cross-browser Testing
BROWSERSTACK_ENABLED=false
SAUCE_LABS_ENABLED=false
LOCAL_BROWSER_TESTING=true

# Visual Regression Testing
VISUAL_TESTING_ENABLED=false
SCREENSHOT_COMPARISON=false

# =============================================================================
# COMPLIANCE AND GOVERNANCE (RELAXED)
# =============================================================================

# Data Retention (shorter)
DATA_RETENTION_ENABLED=true
PROCESSED_IMAGE_RETENTION_DAYS=30
LOG_RETENTION_DAYS=14
METRICS_RETENTION_DAYS=7

# Privacy and Security (relaxed)
GDPR_COMPLIANCE_ENABLED=false
PII_DETECTION_ENABLED=false
DATA_ANONYMIZATION_ENABLED=false

# Audit Logging (simplified)
AUDIT_LOGGING_ENABLED=false
SECURITY_EVENT_LOGGING=true